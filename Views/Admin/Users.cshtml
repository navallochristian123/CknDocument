@model IEnumerable<CKNDocument.Models.LawFirmDMS.User>
@{
    ViewData["Title"] = "Users";
    Layout = "_AdminLayout";
    var roles = ViewData["Roles"] as IEnumerable<CKNDocument.Models.LawFirmDMS.Role> ?? new List<CKNDocument.Models.LawFirmDMS.Role>();
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-0">Users</h4>
        <p class="text-muted mb-0">Manage staff, clients, and auditors</p>
    </div>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
        <i class="bi bi-person-plus"></i> Add User
    </button>
</div>

<!-- Filter Tabs -->
<ul class="nav nav-tabs mb-4" id="userTabs">
    <li class="nav-item">
        <a class="nav-link active" href="#" data-filter="">All Users</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#" data-filter="Staff">Staff</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#" data-filter="Client">Clients</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#" data-filter="Auditor">Auditors</a>
    </li>
</ul>

<!-- Search Bar -->
<div class="card mb-4">
    <div class="card-body py-2">
        <div class="row align-items-center">
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control border-start-0" id="searchInput" placeholder="Search users...">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Locked">Locked</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="roleFilter">
                    <option value="">All Roles</option>
                    @foreach (var role in roles.Where(r => r.RoleName != "Admin" && r.RoleName != "SuperAdmin"))
                    {
                        <option value="@role.RoleName">@role.RoleName</option>
                    }
                </select>
            </div>
            <div class="col-md-2 text-end">
                <button class="btn btn-outline-secondary" id="refreshBtn">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Users Table -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="usersTable">
                <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Last Active</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var user in Model)
                        {
                            var initials = $"{user.FirstName?.FirstOrDefault()}{user.LastName?.FirstOrDefault()}".ToUpper();
                            var role = user.UserRoles.FirstOrDefault()?.Role?.RoleName ?? "No Role";
                            var roleBadgeClass = role switch
                            {
                                "Admin" => "bg-danger",
                                "Staff" => "bg-success",
                                "Client" => "bg-purple",
                                "Auditor" => "bg-info",
                                _ => "bg-secondary"
                            };
                            var statusBadgeClass = user.Status switch
                            {
                                "Active" => "bg-success",
                                "Inactive" => "bg-secondary",
                                "Locked" => "bg-danger",
                                _ => "bg-warning"
                            };
                            var lastActive = user.LastLoginAt.HasValue
                                ? (DateTime.UtcNow - user.LastLoginAt.Value).TotalHours < 24
                                    ? $"{(int)(DateTime.UtcNow - user.LastLoginAt.Value).TotalHours} hours ago"
                                    : user.LastLoginAt.Value.ToString("MMM dd, yyyy")
                                : "Never";

                            <tr data-user-id="@user.UserID" data-role="@role" data-status="@user.Status">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2" style="background-color: @(role == "Staff" ? "#198754" : role == "Client" ? "#a855f7" : role == "Auditor" ? "#0dcaf0" : "#6c757d");">
                                            @initials
                                        </div>
                                        <div>
                                            <div class="fw-medium">@user.FullName</div>
                                            <small class="text-muted">@@@user.Username</small>
                                        </div>
                                    </div>
                                </td>
                                <td>@user.Email</td>
                                <td><span class="badge @roleBadgeClass" style="@(role == "Client" ? "background-color: #a855f7 !important;" : "")">@role</span></td>
                                <td><span class="badge @statusBadgeClass">@user.Status</span></td>
                                <td>@lastActive</td>
                                <td class="text-center">
                                    <div class="btn-group btn-group-sm">
                                        <button type="button" class="btn btn-outline-primary" onclick="viewUser(@user.UserID)" title="View Details">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="editUser(@user.UserID)" title="Edit">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        @if (user.Status == "Active")
                                        {
                                            <button type="button" class="btn btn-outline-danger" onclick="confirmDeactivate(@user.UserID, '@user.FullName')" title="Deactivate">
                                                <i class="bi bi-person-x"></i>
                                            </button>
                                        }
                                        else
                                        {
                                            <button type="button" class="btn btn-outline-success" onclick="confirmActivate(@user.UserID, '@user.FullName')" title="Activate">
                                                <i class="bi bi-person-check"></i>
                                            </button>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
                                <p class="text-muted mt-2">No users found. Click "Add User" to create one.</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="addUserForm" asp-controller="User" asp-action="Create" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addUserModalLabel">
                        <i class="bi bi-person-plus me-2"></i>Add New User
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Role Selection -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">User Role <span class="text-danger">*</span></label>
                        <div class="row g-2">
                            @foreach (var role in roles.Where(r => r.RoleName != "Admin" && r.RoleName != "SuperAdmin"))
                            {
                                var roleIcon = role.RoleName switch
                                {
                                    "Staff" => "bi-person-badge",
                                    "Client" => "bi-person",
                                    "Auditor" => "bi-clipboard-check",
                                    _ => "bi-person"
                                };
                                var roleColor = role.RoleName switch
                                {
                                    "Staff" => "#198754",
                                    "Client" => "#a855f7",
                                    "Auditor" => "#0dcaf0",
                                    _ => "#6c757d"
                                };
                                <div class="col-md-4">
                                    <div class="form-check role-card">
                                        <input class="form-check-input visually-hidden" type="radio" name="RoleId" id="role_@role.RoleID" value="@role.RoleID" required>
                                        <label class="form-check-label role-card-label" for="role_@role.RoleID" style="--role-color: @roleColor;">
                                            <i class="bi @roleIcon role-icon"></i>
                                            <span class="role-name">@role.RoleName</span>
                                        </label>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="invalid-feedback">Please select a role.</div>
                    </div>

                    <hr>

                    <!-- Personal Information -->
                    <h6 class="text-muted mb-3"><i class="bi bi-person me-2"></i>Personal Information</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label">First Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="FirstName" required maxlength="100" 
                                   pattern="[A-Za-z\s]+" title="Only letters and spaces allowed">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Middle Name</label>
                            <input type="text" class="form-control" name="MiddleName" maxlength="100"
                                   pattern="[A-Za-z\s]*" title="Only letters and spaces allowed">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Last Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="LastName" required maxlength="100"
                                   pattern="[A-Za-z\s]+" title="Only letters and spaces allowed">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" name="PhoneNumber" maxlength="11" 
                                   pattern="[0-9]{11}" title="Enter 11-digit phone number">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" name="DateOfBirth" max="@DateTime.Now.AddYears(-18).ToString("yyyy-MM-dd")">
                        </div>
                    </div>

                    <!-- Account Information -->
                    <h6 class="text-muted mb-3"><i class="bi bi-shield-lock me-2"></i>Account Information</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Email Address <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" name="Email" required maxlength="100">
                            <div class="invalid-feedback" id="emailError"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Username <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="Username" required maxlength="100"
                                   pattern="[a-z0-9_]+" title="Lowercase letters, numbers, and underscores only">
                            <div class="invalid-feedback" id="usernameError"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Password <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" name="Password" id="newPassword" required minlength="8">
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">Min 8 characters with uppercase, lowercase, number & special character.</div>
                            <div class="invalid-feedback" id="passwordError"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Confirm Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                            <div class="invalid-feedback">Passwords do not match.</div>
                        </div>
                    </div>

                    <!-- Work Information (collapsible) -->
                    <div class="accordion" id="additionalInfoAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#workInfo">
                                    <i class="bi bi-briefcase me-2"></i>Work Information (Optional)
                                </button>
                            </h2>
                            <div id="workInfo" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Department</label>
                                            <input type="text" class="form-control" name="Department" maxlength="100">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Position</label>
                                            <input type="text" class="form-control" name="Position" maxlength="100">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Bar Number</label>
                                            <input type="text" class="form-control" name="BarNumber" maxlength="50">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">License Number</label>
                                            <input type="text" class="form-control" name="LicenseNumber" maxlength="50">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#addressInfo">
                                    <i class="bi bi-geo-alt me-2"></i>Address Information (Optional)
                                </button>
                            </h2>
                            <div id="addressInfo" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Street Address</label>
                                            <input type="text" class="form-control" name="Street" maxlength="255">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" name="City" maxlength="100">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Province</label>
                                            <input type="text" class="form-control" name="Province" maxlength="100">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Zip Code</label>
                                            <input type="text" class="form-control" name="ZipCode" maxlength="10"
                                                   pattern="[0-9]{4,10}" title="Enter valid zip code">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitAddUser">
                        <i class="bi bi-check-lg me-1"></i>Create User
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editUserForm" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="userId" id="editUserId">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title" id="editUserModalLabel">
                        <i class="bi bi-pencil-square me-2"></i>Edit User
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="editUserContent">
                        <!-- Content loaded via AJAX -->
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitEditUser">
                        <i class="bi bi-check-lg me-1"></i>Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- View User Modal -->
<div class="modal fade" id="viewUserModal" tabindex="-1" aria-labelledby="viewUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="viewUserModalLabel">
                    <i class="bi bi-person-badge me-2"></i>User Details
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="viewUserContent">
                    <!-- Content loaded via AJAX -->
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editFromViewBtn">
                    <i class="bi bi-pencil me-1"></i>Edit User
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Action Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header" id="confirmModalHeader">
                <h5 class="modal-title" id="confirmModalTitle">Confirm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="confirmModalMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <form id="confirmForm" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-sm" id="confirmBtn">Confirm</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Reset Password Modal -->
<div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title"><i class="bi bi-key me-2"></i>Reset Password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Reset password for: <strong id="resetPasswordUserName"></strong></p>
                <div class="mb-3">
                    <label class="form-label">New Password <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="resetNewPassword" required minlength="8">
                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('resetNewPassword')">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                    <div class="form-text">Min 8 characters with uppercase, lowercase, number & special character.</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Confirm Password <span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="resetConfirmPassword" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="submitResetPassword">Reset Password</button>
            </div>
        </div>
    </div>
</div>

@section Styles {
<style>
    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .role-card {
        margin: 0;
    }

    .role-card-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        border: 2px solid #dee2e6;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
    }

    .role-card-label:hover {
        border-color: var(--role-color);
        background-color: rgba(0, 0, 0, 0.02);
    }

    .role-card input:checked + .role-card-label {
        border-color: var(--role-color);
        background-color: rgba(0, 0, 0, 0.05);
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
    }

    .role-icon {
        font-size: 2rem;
        color: var(--role-color);
        margin-bottom: 0.5rem;
    }

    .role-name {
        font-weight: 600;
        color: var(--role-color);
    }

    .bg-purple {
        background-color: #a855f7 !important;
    }

    .table td {
        vertical-align: middle;
    }

    .modal-lg {
        max-width: 800px;
    }

    .form-label {
        font-weight: 500;
        font-size: 0.875rem;
    }

    .accordion-button:not(.collapsed) {
        background-color: #e9ecef;
        color: #212529;
    }
</style>
}

@section Scripts {
<script>
    // Tab filtering
    document.querySelectorAll('#userTabs .nav-link').forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('#userTabs .nav-link').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            filterUsers();
        });
    });

    // Search and filter
    document.getElementById('searchInput').addEventListener('input', filterUsers);
    document.getElementById('statusFilter').addEventListener('change', filterUsers);
    document.getElementById('roleFilter').addEventListener('change', filterUsers);
    document.getElementById('refreshBtn').addEventListener('click', () => location.reload());

    function filterUsers() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const status = document.getElementById('statusFilter').value;
        const role = document.getElementById('roleFilter').value || document.querySelector('#userTabs .nav-link.active').dataset.filter;

        document.querySelectorAll('#usersTableBody tr[data-user-id]').forEach(row => {
            const name = row.querySelector('td:first-child').textContent.toLowerCase();
            const email = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
            const rowRole = row.dataset.role;
            const rowStatus = row.dataset.status;

            const matchSearch = name.includes(search) || email.includes(search);
            const matchStatus = !status || rowStatus === status;
            const matchRole = !role || rowRole === role;

            row.style.display = matchSearch && matchStatus && matchRole ? '' : 'none';
        });
    }

    // Password toggle
    function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = input.nextElementSibling.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('bi-eye', 'bi-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('bi-eye-slash', 'bi-eye');
        }
    }

    // Password validation
    document.getElementById('confirmPassword').addEventListener('input', function() {
        const password = document.getElementById('newPassword').value;
        if (this.value !== password) {
            this.classList.add('is-invalid');
        } else {
            this.classList.remove('is-invalid');
        }
    });

    // Form validation
    document.getElementById('addUserForm').addEventListener('submit', function(e) {
        const password = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            document.getElementById('confirmPassword').classList.add('is-invalid');
            showToast('error', 'Passwords do not match');
            return false;
        }

        // Password strength validation
        const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&])[A-Za-z\d@@$!%*?&]{8,}$/;
        if (!passwordRegex.test(password)) {
            e.preventDefault();
            document.getElementById('passwordError').textContent = 'Password must contain uppercase, lowercase, number, and special character';
            document.getElementById('newPassword').classList.add('is-invalid');
            showToast('error', 'Password does not meet requirements');
            return false;
        }
    });

    // View user
    function viewUser(userId) {
        fetch(`/User/Details/${userId}`)
            .then(response => response.text())
            .then(html => {
                // Parse the response and extract user data
                // For now, redirect to details page
                window.location.href = `/User/Details/${userId}`;
            })
            .catch(error => {
                showToast('error', 'Failed to load user details');
            });
    }

    // Edit user
    function editUser(userId) {
        window.location.href = `/User/Edit/${userId}`;
    }

    // Confirm deactivate
    function confirmDeactivate(userId, userName) {
        document.getElementById('confirmModalTitle').textContent = 'Deactivate User';
        document.getElementById('confirmModalHeader').className = 'modal-header bg-danger text-white';
        document.getElementById('confirmModalMessage').textContent = `Are you sure you want to deactivate ${userName}? They will no longer be able to log in.`;
        document.getElementById('confirmForm').action = `/User/Delete/${userId}`;
        document.getElementById('confirmBtn').className = 'btn btn-danger btn-sm';
        document.getElementById('confirmBtn').textContent = 'Deactivate';
        new bootstrap.Modal(document.getElementById('confirmModal')).show();
    }

    // Confirm activate
    function confirmActivate(userId, userName) {
        document.getElementById('confirmModalTitle').textContent = 'Activate User';
        document.getElementById('confirmModalHeader').className = 'modal-header bg-success text-white';
        document.getElementById('confirmModalMessage').textContent = `Are you sure you want to activate ${userName}? They will be able to log in again.`;
        document.getElementById('confirmForm').action = `/User/Activate/${userId}`;
        document.getElementById('confirmBtn').className = 'btn btn-success btn-sm';
        document.getElementById('confirmBtn').textContent = 'Activate';
        new bootstrap.Modal(document.getElementById('confirmModal')).show();
    }

    // Toast notification
    function showToast(type, message) {
        // Using Bootstrap toast or custom implementation
        alert(message); // Replace with proper toast
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Show any server-side toast messages
        @if (TempData["ToastType"] != null)
        {
            <text>
            showToast('@TempData["ToastType"]', '@TempData["ToastMessage"]');
            </text>
        }
    });
</script>
}
